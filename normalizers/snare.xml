<?xml version="1.0" encoding="UTF-8"?>

<!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
<!-- -->
<!-- pylogparser - Logs parsers python library -->
<!-- Copyright (C) 2011 Wallix Inc. -->
<!-- -->
<!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->
<!-- -->
<!-- This package is free software; you can redistribute -->
<!-- it and/or modify it under the terms of the GNU Lesser -->
<!-- General Public License as published by the Free Software -->
<!-- Foundation; either version 2.1 of the License, or (at -->
<!-- your option) any later version. -->
<!-- -->
<!-- This package is distributed in the hope that it will be -->
<!-- useful, but WITHOUT ANY WARRANTY; without even the implied -->
<!-- warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR -->
<!-- PURPOSE. See the GNU Lesser General Public License for -->
<!-- more details. -->
<!-- -->
<!-- You should have received a copy of the GNU Lesser General -->
<!-- Public License along with this package; if not, write -->
<!-- to the Free Software Foundation, Inc., 59 Temple Place, -->
<!-- Suite 330, Boston, MA 02111-1307 USA -->
<!-- -->
<!--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++-->

<!DOCTYPE normalizer SYSTEM "normalizer.dtd">

<normalizer name="SnareConvertedLog"
	    version="0.99"
	    unicode="yes"
	    ignorecase="yes"
	    matchtype= "search"
	    appliedTo= "raw">
  
  <description>
    <localized_desc language="en">This normalizer parses event logs sent by Snare agent for Windows.</localized_desc>
    <localized_desc language="fr">Ce normaliser analyse les logs envoyés par Snare agent for Windows</localized_desc>
  </description>
  <authors>
    <author>clo@wallix.com</author>
  </authors>

  <tagTypes>
    <tagType name="windows_names" type="basestring">
      <description>
	<localized_desc language="en">String containing Windows' authorized characters for computers, users, etc...</localized_desc>
	<localized_desc language="fr">Chaîne contenant les caractères autorisés de Windows pour les noms d'ordinateur, utilisateurs etc..</localized_desc>
      </description>
      <regexp>[\\a-zA-Z0-9_-]+|(?:N/A)</regexp>
    </tagType>
    <tagType name="snare_event_log_type" type="basestring">
      <description>
	<localized_desc language="en">'MSWinEventLog' for Snare for Windows.</localized_desc>
	<localized_desc language="fr">'MSWinEventLog' pour Snare for Windows.</localized_desc>
      </description>
      <regexp>MSWinEventLog</regexp>
    </tagType>
    <tagType name="criticality" type="number">
      <description>
	<localized_desc language="en">Criticality tag is a number between 0 and 4.</localized_desc>
	<localized_desc language="fr">Le tag criticité est un nombre entre 0 et 4.</localized_desc>
      </description>
      <regexp>[0-4]</regexp>
    </tagType>
    <tagType name="event_log_source" type="basestring">
      <description>
	<localized_desc language="en">After different tests, event_log_source is a string containing [a-zA-Z-_]+, but it may be able to contain more than those characters. Change regexp in that case.</localized_desc>
	<localized_desc language="fr">Après plusieurs tests, event_log_source est une chaîne contenant [a-zA-Z-_]+ mais elle pourrait contenir d'autres caracrères, il faudra changer la regexp dans ce cas.</localized_desc>
      </description>
      <regexp>[a-zA-Z-_]+</regexp>
    </tagType>
    <tagType name="host_date" type="date">
      <description>
	<localized_desc language="en">This is the date sent by host, in host language.</localized_desc>
	<localized_desc language="fr">La date envoyée par l'hôte, dans son language.</localized_desc>
      </description>
	<regexp>\w{3}. \w+ \d{1,2} \d{1,2}:\d{1,2}:\d{1,2} \d{1,4}</regexp>
    </tagType>
    <tagType name="sid_type" tagType="sid_type_regexp">
      <description>
	<localized_desc language="en">This is the type of SID used.</localized_desc>
	<localized_desc language="fr">Type de SID utilisé.</localized_desc>
      </description>
      <regexp>[A-Z][a-zA-Z]+(?: [A-Z][a-zA-Z]+)*</regexp>
    </tagType>
    <tagType name="event_log_type" type="basestring">
      <description>
	<localized_desc language="en">String that can be anyone of the following regexp.</localized_desc>
	<localized_desc language="fr">Chaîne pouvant être une des regexp suivantes.</localized_desc>
      </description>
      <regexp>Success Audit|Failure Audit|Error|Warning|Information</regexp>
    </tagType>
    <tagType name="audit_event_category" type="basestring">
      <description>
	<localized_desc language="en">String designating one of the Windows audit categories.</localized_desc>
	<localized_desc language="fr">Chaîne désignant une des catégories de contrôle de Windows..</localized_desc>
      </description>
      <regexp>[A-Z][a-zA-Z]+(?: [a-zA-Z]+)*</regexp>
    </tagType>
    <tagType name="data_str" type="basestring">
      <description>
	<localized_desc language="en">String designating one of the Windows audit categories.</localized_desc>
	<localized_desc language="fr">Chaîne désignant une des catégories de contrôle de Windows..</localized_desc>
      </description>
      <regexp>[^\t\n\r\f\v]+</regexp>
    </tagType>

  </tagTypes>
  <patterns>
    <pattern name="Snare-001">
      <description>
	<localized_desc language="en"></localized_desc>
	<localized_desc language="fr"></localized_desc>
      </description>
      <text>(?:HOST_NAME\s+)?SNARE_EVENT_LOG_TYPE\sCRITICALITY\s+SOURCE_NAME\s+SNARE_EVENT_COUNTER\s+DATETIME\s+EVENT_ID\s+EXPANDED_SOURCENAME\s+USER_NAME[$]?\s+SID_TYPE\s+EVENT_LOGTYPE\s+COMPUTER_NAME\s+</text>

      <tags>
	<tag name="host_name" tagType="windows_names">
	  <description>
	    <localized_desc language="en">This is the sender's host name.</localized_desc>
	    <localized_desc language="fr">Le nom d'hôte du destinateur.</localized_desc>
	  </description>
	  <substitute>HOST_NAME</substitute>
	</tag>
	<tag name="snare_event_log_type" tagType="snare_event_log_type">
	  <description>
	    <localized_desc language="en">'MSWinEventLog' for Snare for Windows.</localized_desc>
	    <localized_desc language="fr">'MSWinEventLog' pour Snare for Windows.</localized_desc>
	  </description>
	  <substitute>SNARE_EVENT_LOG_TYPE</substitute>
	</tag>
	<tag name="criticality" tagType="criticality">
	  <description>
	    <localized_desc language="en">This is determinated by the Alert level given to the objective by the user. (In Snare Agent)</localized_desc>
	    <localized_desc language="fr">Niveau d'alerte configuré depuis les objectives de l'agent Snare.</localized_desc>
	  </description>
	  <substitute>CRITICALITY</substitute>
	</tag>
	<tag name="event_log_source_name" tagType="event_log_source">
	  <description>
	    <localized_desc language="en">This is the Windows Event Log from which the event record was derived.</localized_desc>
	    <localized_desc language="fr">Nom du journal Windows d'où vient l'évènement.</localized_desc>
	  </description>
	  <substitute>SOURCE_NAME</substitute>
	</tag>	
	<tag name="snare_event_counter" tagType="Integer">
	  <description>
	    <localized_desc language="en">Based on the internal Snare event counter.</localized_desc>
	    <localized_desc language="fr">Basé sur le compteur interne des évènements de Snare.</localized_desc>
	  </description>
	  <substitute>SNARE_EVENT_COUNTER</substitute>
	</tag>
	<tag name="date" tagType="host_date">
	  <description>
	    <localized_desc language="en">This is the date time stamp of the event record.</localized_desc>
	    <localized_desc language="fr">Date d'enregistrement de l'évènement.</localized_desc>
	  </description>
	  <substitute>DATETIME</substitute>
	</tag>
	<tag name="event_id" tagType="Integer">
	  <description>
	    <localized_desc language="en">This is the Windows event ID.</localized_desc>
	    <localized_desc language="fr">ID de l'évènement Windows.</localized_desc>
	  </description>
	  <substitute>EVENT_ID</substitute>
	</tag>
	<tag name="event_log_expanded_source_name" tagType="event_log_source">
	  <description>
	    <localized_desc language="en">This is the Windows Event Log from which the event record was derived.</localized_desc>
	    <localized_desc language="fr">Nom du journal Windows d'où vient l'évènement.</localized_desc>
	  </description>
	  <substitute>EXPANDED_SOURCENAME</substitute>
	</tag>
	<tag name="user_name" tagType="windows_names">
	  <description>
	    <localized_desc language="en">This is the Windows' user name.</localized_desc>
	    <localized_desc language="fr">Nom d'utilisateur Windows.</localized_desc>
	  </description>
	  <substitute>USER_NAME</substitute>
	</tag>
	<tag name="sid_used" tagType="sid_type">
	  <description>
	    <localized_desc language="en">This is the type of SID used.</localized_desc>
	    <localized_desc language="fr">Type de SID utilisé.</localized_desc>
	  </description>
	  <substitute>SID_TYPE</substitute>
	</tag>
	<tag name="event_log_type" tagType="event_log_type">
	  <description>
	    <localized_desc language="en">This can be anyone of 'Success Audit', 'Failure Audit', 'Error', 'Information', 'Warning'.</localized_desc>
	    <localized_desc language="fr">Peut être un des suivants: 'Success Audit', 'Failure Audit', 'Error', 'Information', 'Warning'.</localized_desc>
	  </description>
	  <substitute>EVENT_LOGTYPE</substitute>
	</tag>
	<tag name="computer_name" tagType="windows_names">
	  <description>
	    <localized_desc language="en">This is the Windows computer name.</localized_desc>
	    <localized_desc language="fr">Nom de l'ordinateur.</localized_desc>
	  </description>
	  <substitute>COMPUTER_NAME</substitute>
	</tag>
	
      </tags>

      <examples>
	<example>
	  <text>MSWinEventLog	1	Application	194	jeu. août 25 11:36:29 201	10	Microsoft-Windows-WMI	N/A	Administrator	Error	a-zA-Z0-9_	None		Le filtre d’événement avec la requête « SELECT * FROM __InstanceModificationEvent WITHIN 60 WHERE TargetInstance ISA "Win32_Processor" AND TargetInstance.LoadPercentage &gt; 99 » n’a pas pu être réactivé dans l’espace de noms « //./root/CIMV2 » à cause de l’erreur 0x80041003. Les événements ne peuvent pas être délivrés à travers ce filtre tant que le problème ne sera pas corrigé.	15</text>
	  <expectedTags>
	    <expectedTag name="host_name"></expectedTag>
	    <expectedTag name="snare_event_log_type">MSWinEventLog</expectedTag>
	    <expectedTag name="criticality">1</expectedTag>
	    <expectedTag name="event_log_source_name">Application</expectedTag>
	    <expectedTag name="snare_event_counter">194</expectedTag>
	    <expectedTag name="date">jeu. août 25 11:36:29 201</expectedTag>
	    <expectedTag name="event_id">10</expectedTag>
	    <expectedTag name="event_log_expanded_source_name">Microsoft-Windows-WMI</expectedTag>
	    <expectedTag name="user_name">N/A</expectedTag>
	    <expectedTag name="sid_used">Administrator</expectedTag>
	    <expectedTag name="event_log_type">Error</expectedTag>
	    <expectedTag name="computer_name">a-zA-Z0-9_</expectedTag>
	  </expectedTags>
	</example>
      </examples>
    </pattern>
  </patterns>  
</normalizer>
